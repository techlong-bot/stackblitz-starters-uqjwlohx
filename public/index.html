<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pionex-Lite | Grid Trading</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg: #0b0e11;
            --panel: #161b22;
            --border: #252b36;
            --text-main: #eaecef;
            --text-sub: #848e9c;
            --primary: #0d6efd; /* Pionex Blue-ish */
            --green: #0ecb81;
            --red: #f6465d;
        }
        body { background-color: var(--bg); color: var(--text-main); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        .header { height: 50px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; }
        .logo { font-weight: 800; font-size: 18px; letter-spacing: 1px; }
        .balance-pill { font-size: 13px; background: #2b3139; padding: 5px 12px; border-radius: 4px; color: var(--text-main); }

        /* MAIN LAYOUT */
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* LEFT: MARKETS */
        .market-list { width: 260px; border-right: 1px solid var(--border); display: flex; flex-direction: column; background: var(--bg); }
        .market-header { padding: 10px; border-bottom: 1px solid var(--border); font-size: 12px; color: var(--text-sub); display: flex; justify-content: space-between; }
        .coin-row { display: flex; justify-content: space-between; padding: 10px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #1e2329; }
        .coin-row:hover { background: #2b3139; }
        .coin-row.active { background: #2b3139; border-left: 3px solid var(--primary); }

        /* CENTER: CHART */
        .chart-area { flex: 1; display: flex; flex-direction: column; background: var(--bg); }
        .chart-header { height: 40px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 15px; font-weight: bold; font-size: 16px; gap: 15px; }
        .price-display { color: var(--green); font-size: 16px; }

        /* RIGHT: BOT PANEL */
        .bot-panel { width: 320px; border-left: 1px solid var(--border); background: var(--panel); display: flex; flex-direction: column; }
        .bot-tabs { display: flex; border-bottom: 1px solid var(--border); }
        .tab { flex: 1; text-align: center; padding: 15px 0; font-size: 14px; cursor: pointer; color: var(--text-sub); border-bottom: 2px solid transparent; }
        .tab.active { color: var(--primary); border-bottom: 2px solid var(--primary); font-weight: bold; }
        
        .bot-form { padding: 20px; flex: 1; overflow-y: auto; }
        .input-group { margin-bottom: 20px; }
        .label { display: block; font-size: 12px; color: var(--text-sub); margin-bottom: 8px; }
        .input-box { width: 100%; background: #0b0e11; border: 1px solid var(--border); padding: 10px; color: white; border-radius: 4px; box-sizing: border-box; }
        
        .ai-badge { background: linear-gradient(90deg, #7b61ff, #0d6efd); color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-left: 5px; }
        
        .btn-create { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-create:hover { opacity: 0.9; }

        /* BOTTOM: ORDERS */
        .bottom-panel { height: 250px; border-top: 1px solid var(--border); background: var(--panel); display: flex; flex-direction: column; }
        .orders-header { padding: 10px 20px; border-bottom: 1px solid var(--border); font-size: 13px; font-weight: bold; color: var(--text-sub); }
        .orders-list { flex: 1; overflow-y: auto; }
        .order-row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr; padding: 10px 20px; font-size: 12px; border-bottom: 1px solid var(--border); color: var(--text-sub); align-items: center; }
        .order-row.head { background: #0b0e11; }
        .pnl-green { color: var(--green); }
        .pnl-red { color: var(--red); }
        .btn-stop { background: var(--border); color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; }

        /* UTILS */
        .green-txt { color: var(--green); } .red-txt { color: var(--red); }
        .scroll { overflow-y: auto; flex: 1; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">PIONEX <span style="font-weight:400; font-size:12px; color:#848e9c">LITE</span></div>
        <div class="balance-pill">Wallet: <span id="walletBalance" style="color:white; font-weight:bold">$10,000.00</span></div>
    </div>

    <div class="main-container">
        
        <div class="market-list">
            <div class="market-header">
                <span>Pair</span>
                <span>Last Price</span>
            </div>
            <div id="coinList" class="scroll">
                <div style="padding:20px; text-align:center; font-size:12px; color:#848e9c">Loading...</div>
            </div>
        </div>

        <div class="chart-area">
            <div class="chart-header">
                <span id="activePair">BTC/USDT</span>
                <span id="activePrice" class="price-display">---</span>
                <span id="activeChange" style="font-size:12px; color:#848e9c">0.00%</span>
            </div>
            <div id="tv_chart_container" style="flex:1; width:100%;"></div>
        </div>

        <div class="bot-panel">
            <div class="bot-tabs">
                <div class="tab active">Grid Trading Bot</div>
                <div class="tab">DCA Bot</div>
            </div>

            <div class="bot-form">
                <div style="margin-bottom:20px; border:1px solid #2b3139; padding:10px; border-radius:4px; font-size:12px; color:#848e9c; line-height:1.4">
                    <strong style="color:white">Strategy Description:</strong><br>
                    Buy low and sell high automatically 24/7 within a price range.
                </div>

                <div style="background:#1e2329; padding:15px; border-radius:6px; border:1px solid #0d6efd; margin-bottom:20px; cursor:pointer" onclick="useAIStrategy()">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px">
                        <span style="font-size:12px; font-weight:bold; color:white">AI Strategy <span class="ai-badge">7D Backtest</span></span>
                        <span style="font-size:12px; color:#0ecb81">~87.5% APR</span>
                    </div>
                    <div style="font-size:11px; color:#848e9c">
                        Range: <span id="aiRange">...</span><br>
                        Grids: <span id="aiGrids">...</span>
                    </div>
                </div>

                <div class="input-group">
                    <label class="label">Lower Price (USDT)</label>
                    <input type="number" id="lowerPrice" class="input-box" placeholder="0.00">
                </div>
                <div class="input-group">
                    <label class="label">Upper Price (USDT)</label>
                    <input type="number" id="upperPrice" class="input-box" placeholder="0.00">
                </div>
                <div class="input-group">
                    <label class="label">Grid Quantity</label>
                    <input type="number" id="gridQty" class="input-box" placeholder="2 - 200">
                </div>
                <div class="input-group">
                    <label class="label">Investment (USDT)</label>
                    <input type="number" id="investAmt" class="input-box" placeholder="Min 100">
                </div>

                <button class="btn-create" onclick="createBot()">CREATE BOT</button>
            </div>
        </div>

    </div>

    <div class="bottom-panel">
        <div class="orders-header">My Running Bots (Paper Trading)</div>
        <div class="order-row head">
            <span>Pair</span>
            <span>Range</span>
            <span>Grid Profit</span>
            <span>Total PnL</span>
            <span>Status</span>
            <span>Action</span>
        </div>
        <div id="botList" class="orders-list">
            </div>
    </div>

    <script>
        // CONFIG
        const COINS = ["BTC", "ETH", "SOL", "BNB", "XRP", "DOGE", "ADA", "MATIC", "DOT", "LTC"];
        let activeSymbol = "BTC";
        let marketPrices = {}; // Store live prices { "BTC": 50000.00 }
        let walletCash = 10000;
        let runningBots = [];
        let socket = null;

        // --- 1. INITIALIZATION ---
        function init() {
            renderCoinList();
            loadChart("BTC");
            startSocket();
            updateWalletUI();
            
            // Simulation Loop for Bots
            setInterval(updateBots, 1000); 
        }

        // --- 2. MARKET LIST & DATA ---
        function renderCoinList() {
            const list = document.getElementById('coinList');
            list.innerHTML = "";
            COINS.forEach(sym => {
                const el = document.createElement('div');
                el.className = `coin-row ${sym === activeSymbol ? 'active' : ''}`;
                el.id = `row-${sym}`;
                el.onclick = () => switchPair(sym);
                el.innerHTML = `
                    <span style="font-weight:bold">${sym}/USDT</span>
                    <span id="price-${sym}">--</span>
                `;
                list.appendChild(el);
            });
            // Auto calc AI params for default
            setTimeout(calcAIParams, 1000);
        }

        function switchPair(sym) {
            activeSymbol = sym;
            // Update UI Selection
            document.querySelectorAll('.coin-row').forEach(el => el.classList.remove('active'));
            document.getElementById(`row-${sym}`).classList.add('active');
            
            // Update Header
            document.getElementById('activePair').innerText = `${sym}/USDT`;
            
            // Reload Chart
            loadChart(sym);
            calcAIParams();
        }

        function loadChart(sym) {
            const container = document.getElementById('tv_chart_container');
            container.innerHTML = `<iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_1&symbol=BINANCE:${sym}USDT&interval=15&hidesidetoolbar=1&symboledit=1&saveimage=0&toolbarbg=f1f3f6&studies=[]&theme=dark&style=1&timezone=Etc%2FUTC" style="width:100%; height:100%; border:none;"></iframe>`;
        }

        // --- 3. LIVE DATA ---
        function startSocket() {
            socket = new WebSocket('wss://stream.binance.com:9443/ws/!miniTicker@arr');
            socket.onmessage = (e) => {
                const data = JSON.parse(e.data);
                data.forEach(t => {
                    const sym = t.s.replace('USDT', '');
                    if (COINS.includes(sym)) {
                        const price = parseFloat(t.c);
                        marketPrices[sym] = price;
                        
                        // Update Side List
                        const el = document.getElementById(`price-${sym}`);
                        if(el) {
                            el.innerText = price.toFixed(price < 1 ? 4 : 2);
                            el.className = parseFloat(t.P) >= 0 ? 'green-txt' : 'red-txt';
                        }

                        // Update Main Header if active
                        if(sym === activeSymbol) {
                            document.getElementById('activePrice').innerText = price.toFixed(2);
                            document.getElementById('activeChange').innerText = `${parseFloat(t.P).toFixed(2)}%`;
                            document.getElementById('activeChange').style.color = parseFloat(t.P) >= 0 ? '#0ecb81' : '#f6465d';
                            document.getElementById('activePrice').style.color = parseFloat(t.P) >= 0 ? '#0ecb81' : '#f6465d';
                        }
                    }
                });
            };
        }

        // --- 4. BOT LOGIC (PIONEX STYLE) ---
        
        function calcAIParams() {
            // Simple logic: Current Price +/- 10%
            const price = marketPrices[activeSymbol] || 0;
            if(price === 0) return;

            const lower = price * 0.9;
            const upper = price * 1.1;
            const grids = 20;

            document.getElementById('aiRange').innerText = `${lower.toFixed(2)} - ${upper.toFixed(2)}`;
            document.getElementById('aiGrids').innerText = `${grids}`;
            
            return { lower, upper, grids };
        }

        function useAIStrategy() {
            const params = calcAIParams();
            if(!params) return;
            document.getElementById('lowerPrice').value = params.lower.toFixed(2);
            document.getElementById('upperPrice').value = params.upper.toFixed(2);
            document.getElementById('gridQty').value = params.grids;
            document.getElementById('investAmt').value = 1000; // Default invest
        }

        function createBot() {
            const lower = parseFloat(document.getElementById('lowerPrice').value);
            const upper = parseFloat(document.getElementById('upperPrice').value);
            const grids = parseInt(document.getElementById('gridQty').value);
            const invest = parseFloat(document.getElementById('investAmt').value);

            if(!lower || !upper || !grids || !invest) return alert("Please fill all fields");
            if(invest > walletCash) return alert("Insufficient Balance");

            // Deduct Balance
            walletCash -= invest;
            updateWalletUI();

            const bot = {
                id: Date.now(),
                pair: activeSymbol,
                entry: marketPrices[activeSymbol],
                lower, upper, grids, invest,
                gridProfit: 0,
                status: 'RUNNING'
            };
            runningBots.push(bot);
            renderBots();
        }

        function stopBot(id) {
            const botIndex = runningBots.findIndex(b => b.id === id);
            if(botIndex === -1) return;
            
            const bot = runningBots[botIndex];
            
            // Calculate Final PnL
            const currentPrice = marketPrices[bot.pair];
            const pnl = (currentPrice - bot.entry) / bot.entry * bot.invest; // Simple simulation
            const totalReturn = bot.invest + pnl + bot.gridProfit;

            walletCash += totalReturn;
            updateWalletUI();

            runningBots.splice(botIndex, 1);
            renderBots();
        }

        function updateBots() {
            // Simulate Grid Profit (Volatility)
            runningBots.forEach(bot => {
                // Every second, small chance to make "Grid Profit" (Arbitrage/Volatility)
                // In real grid bot, price crosses lines. Here we sim it.
                if(Math.random() > 0.7) { 
                    const tinyProfit = bot.invest * 0.0005; // 0.05% profit
                    bot.gridProfit += tinyProfit;
                }
            });
            renderBots(); // Refresh UI
        }

        function renderBots() {
            const list = document.getElementById('botList');
            list.innerHTML = "";
            
            runningBots.forEach(bot => {
                const currentPrice = marketPrices[bot.pair] || bot.entry;
                // Unrealized PnL (Price movement)
                const unrealized = (currentPrice - bot.entry) / bot.entry * bot.invest;
                const totalPnL = unrealized + bot.gridProfit;
                const pnlClass = totalPnL >= 0 ? 'pnl-green' : 'pnl-red';

                const row = document.createElement('div');
                row.className = 'order-row';
                row.innerHTML = `
                    <div style="font-weight:bold; color:white">${bot.pair}/USDT</div>
                    <div>${bot.lower.toFixed(2)} - ${bot.upper.toFixed(2)}</div>
                    <div class="pnl-green">+$${bot.gridProfit.toFixed(4)}</div>
                    <div class="${pnlClass}">${totalPnL >= 0 ? '+' : ''}$${totalPnL.toFixed(2)}</div>
                    <div style="color:#0d6efd">RUNNING</div>
                    <div><button class="btn-stop" onclick="stopBot(${bot.id})">STOP</button></div>
                `;
                list.appendChild(row);
            });
        }

        function updateWalletUI() {
            document.getElementById('walletBalance').innerText = `$${walletCash.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        }

        init();

    </script>
</body>
</html>