<!DOCTYPE html>
<html>
<head>
    <title>Titan Bot Commander</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --border: #30363d; --text: #c9d1d9; --accent: #58a6ff; --green: #2ea043; --red: #ff7b72; --gold: #e3b341; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', monospace; margin: 0; padding: 10px; overflow-x: hidden; }

        /* HEADER & GRID */
        .top-bar { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 15px; }
        h1 { margin: 0; color: var(--accent); font-size: 18px; letter-spacing: 1px; }
        .grid { display: grid; grid-template-columns: 260px 1fr 260px; gap: 15px; height: 85vh; }
        
        /* PANELS */
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 6px; display: flex; flex-direction: column; overflow: hidden; }
        .p-head { padding: 8px 12px; background: #010409; border-bottom: 1px solid var(--border); font-weight: bold; font-size: 11px; display: flex; justify-content: space-between; align-items: center; letter-spacing: 0.5px; }
        .scroll { overflow-y: auto; flex: 1; }

        /* BOT CONTROLS */
        .bot-status { padding: 10px; background: #21262d; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #30363d; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--green); }
        input:checked + .slider:before { transform: translateX(14px); }

        /* LOGS */
        .log-item { padding: 6px 10px; border-bottom: 1px solid #21262d; font-size: 11px; font-family: monospace; border-left: 3px solid transparent; }
        .log-buy { border-left-color: var(--green); background: rgba(46,160,67,0.05); }
        .log-sell { border-left-color: var(--red); background: rgba(255,123,114,0.05); }

        /* MAIN TABLE */
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { text-align: right; padding: 8px; color: #8b949e; background: #0d1117; position: sticky; top: 0; }
        th:first-child { text-align: left; }
        td { padding: 8px; border-bottom: 1px solid var(--border); text-align: right; }
        td:first-child { text-align: left; }
        tr:hover { background: #21262d; cursor: pointer; }

        /* UTILS */
        .btn { background: var(--border); color: white; border: none; padding: 3px 8px; border-radius: 3px; cursor: pointer; font-size: 10px; }
        .btn:hover { background: var(--accent); }
        .green-txt { color: var(--green); } .red-txt { color: var(--red); }
        .score-bar { width: 50px; height: 4px; background: #30363d; display: inline-block; border-radius: 2px; }
        .score-fill { height: 100%; }

        /* CHART MODAL */
        #chartModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; }
        .modal-content { width: 95%; height: 90%; margin: 2% auto; background: var(--panel); display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <div class="top-bar">
        <h1>âš¡ TITAN <span style="color:#8b949e">//</span> AUTO-PILOT</h1>
        <div style="display:flex; gap:20px; font-size:13px">
            <div>CASH: <b id="cashVal" class="green-txt">$10,000</b></div>
            <div>EQUITY: <b id="equityVal">$10,000</b></div>
            <div>PNL: <b id="pnlVal" style="color:#8b949e">0.00%</b></div>
        </div>
    </div>

    <div class="grid">
        
        <div class="panel">
            <div class="p-head">
                <span>ðŸ¤– BOT CONTROLS</span>
                <span id="botStateText" style="color:#8b949e">OFFLINE</span>
            </div>
            
            <div class="bot-status">
                <span style="font-size:12px"><b>MASTER SWITCH</b><br><span style="font-size:10px; color:#8b949e">Auto-Trade High Scores</span></span>
                <label class="switch">
                    <input type="checkbox" id="botToggle" onchange="toggleBot()">
                    <span class="slider"></span>
                </label>
            </div>

            <div style="padding:10px; font-size:11px; color:#8b949e; border-bottom:1px solid var(--border)">
                STRATEGY: <b style="color:#c9d1d9">MOMENTUM SCALPER</b><br>
                â€¢ BUY: Score > 80 (Strong Buy)<br>
                â€¢ SELL: Score < 40 OR Profit > 1.5%
            </div>

            <div class="p-head">ðŸ“œ EXECUTION LOG</div>
            <div class="scroll" id="botLog">
                <div style="padding:10px; text-align:center; color:#8b949e; font-size:11px">Waiting for signals...</div>
            </div>
        </div>

        <div class="panel">
            <div class="p-head">
                <span>MARKET SCANNER (Top 25)</span>
                <button class="btn" onclick="init()">REFRESH</button>
            </div>
            <div class="scroll">
                <table id="mainTable">
                    <thead>
                        <tr>
                            <th>Asset</th>
                            <th>Price</th>
                            <th>24h %</th>
                            <th>Titan Score</th>
                            <th>Holdings</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="panel">
            <div class="p-head">ðŸ’¼ OPEN POSITIONS</div>
            <div class="scroll" id="positionsPanel" style="max-height: 200px; border-bottom: 1px solid var(--border)">
                <div style="padding:10px; text-align:center; color:#8b949e; font-size:11px">No active trades</div>
            </div>
            
            <div class="p-head">ðŸš¨ WHALE RADAR (>$50k)</div>
            <div class="scroll" id="whaleFeed"></div>
        </div>

    </div>

    <div id="chartModal">
        <div class="modal-content">
            <div class="p-head" style="height:30px">
                <span id="chartTitle">CHART</span>
                <button class="btn" onclick="document.getElementById('chartModal').style.display='none'">CLOSE</button>
            </div>
            <div id="chartContainer" style="flex:1"></div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const COINS = ["BTC","ETH","SOL","BNB","XRP","DOGE","ADA","AVAX","TRX","DOT","LINK","MATIC","LTC","SHIB","UNI","ATOM","XLM","NEAR","APT","OP"];
        const TRADE_SIZE = 1000; // Bot invests $1000 per trade
        
        // --- STATE ---
        let marketData = [];
        let wallet = { cash: 10000, positions: {} }; // { "BTC": { amount: 0.1, entry: 50000 } }
        let botActive = false;
        let socket = null;

        // --- 1. CORE LOOPS ---
        async function init() {
            try {
                // Get Prices + Sparklines for Math
                const ids = "bitcoin,ethereum,solana,binancecoin,ripple,dogecoin,cardano,avalanche-2,tron,polkadot,chainlink,matic-network,litecoin,shiba-inu,uniswap,cosmos,stellar,near,aptos,optimism";
                const res = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&sparkline=true`);
                const data = await res.json();
                
                marketData = data.map(c => {
                    const rsi = calcRSI(c.sparkline_in_7d.price);
                    const score = calcScore(c, rsi);
                    return { ...c, symbol: c.symbol.toUpperCase(), rsi, score };
                });

                renderTable();
                updateWalletUI();
                
                if(botActive) runBotLogic(); // Check for trades
                
                // Start live feeds if not already running
                if(!socket) startLiveFeed();

            } catch(e) { console.log(e); }
        }

        // --- 2. MATH ENGINE ---
        function calcRSI(prices) {
            if(!prices || prices.length < 15) return 50;
            let gains=0, losses=0;
            for(let i=1; i<15; i++) {
                let diff = prices[i] - prices[i-1];
                if(diff>=0) gains+=diff; else losses+=Math.abs(diff);
            }
            if(losses===0) return 100;
            return 100 - (100/(1+(gains/losses)));
        }

        function calcScore(coin, rsi) {
            let s = 50;
            if(rsi < 30) s += 25; // Oversold
            if(rsi > 70) s -= 25; // Overbought
            if(coin.price_change_percentage_24h > 2) s += 15; // Momentum
            if(coin.price_change_percentage_24h < -2) s -= 15; // Dump
            return Math.min(100, Math.max(0, s));
        }

        // --- 3. BOT LOGIC (AUTO-PILOT) ---
        function toggleBot() {
            botActive = document.getElementById('botToggle').checked;
            const status = document.getElementById('botStateText');
            status.innerText = botActive ? "SCANNING..." : "OFFLINE";
            status.style.color = botActive ? "#2ea043" : "#8b949e";
            if(botActive) log("Bot Activated. Searching for signals...");
        }

        function runBotLogic() {
            marketData.forEach(coin => {
                const sym = coin.symbol;
                const price = coin.current_price;
                const score = coin.score;
                
                // 1. BUY LOGIC
                if (!wallet.positions[sym] && score >= 80 && wallet.cash >= TRADE_SIZE) {
                    executeTrade('BUY', sym, price, TRADE_SIZE);
                }

                // 2. SELL LOGIC (Take Profit or Stop Loss)
                if (wallet.positions[sym]) {
                    const pos = wallet.positions[sym];
                    const pnlPct = ((price - pos.entry) / pos.entry) * 100;
                    
                    // Sell if: Score drops (Weakness) OR Profit > 1.5% OR Stop Loss < -2%
                    if (score < 40 || pnlPct > 1.5 || pnlPct < -2) {
                        executeTrade('SELL', sym, price, 0); // Sell all
                    }
                }
            });
        }

        function executeTrade(type, sym, price, usdAmount) {
            if (type === 'BUY') {
                const amount = usdAmount / price;
                wallet.cash -= usdAmount;
                wallet.positions[sym] = { amount: amount, entry: price };
                log(`BUY ${sym} @ $${price} (Score: High)`, 'buy');
            } else {
                const pos = wallet.positions[sym];
                const revenue = pos.amount * price;
                const profit = revenue - (pos.amount * pos.entry);
                wallet.cash += revenue;
                delete wallet.positions[sym];
                
                const pnlStr = profit >= 0 ? `+$${profit.toFixed(2)}` : `-$${Math.abs(profit).toFixed(2)}`;
                log(`SELL ${sym} @ $${price} | PnL: ${pnlStr}`, profit >= 0 ? 'buy' : 'sell');
            }
            updateWalletUI();
            renderTable();
        }

        function log(msg, type='') {
            const box = document.getElementById('botLog');
            const div = document.createElement('div');
            div.className = `log-item ${type === 'buy' ? 'log-buy' : type === 'sell' ? 'log-sell' : ''}`;
            const time = new Date().toLocaleTimeString().split(' ')[0];
            div.innerText = `[${time}] ${msg}`;
            box.prepend(div);
        }

        // --- 4. UI UPDATES ---
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";
            
            marketData.sort((a,b) => b.score - a.score); // Best scores top

            marketData.forEach(c => {
                const color = c.score >= 80 ? 'green-txt' : c.score <= 40 ? 'red-txt' : '#8b949e';
                const pos = wallet.positions[c.symbol];
                
                const tr = document.createElement('tr');
                tr.onclick = () => openChart(c.symbol);
                tr.innerHTML = `
                    <td>
                        <div style="display:flex; align-items:center; gap:8px">
                            <img src="${c.image}" style="width:20px; border-radius:50%">
                            <b>${c.symbol}</b>
                        </div>
                    </td>
                    <td>$${c.current_price.toLocaleString()}</td>
                    <td class="${c.price_change_percentage_24h>=0?'green-txt':'red-txt'}">${c.price_change_percentage_24h.toFixed(2)}%</td>
                    <td>
                        <div class="score-bar"><div class="score-fill" style="width:${c.score}%; background:${c.score>=80?'#2ea043':c.score<=40?'#ff7b72':'#8b949e'}"></div></div>
                        <span style="font-size:10px; margin-left:5px; color:${color}">${c.score}</span>
                    </td>
                    <td style="color:#e3b341; font-weight:bold">${pos ? 'HELD' : ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateWalletUI() {
            // Cash
            document.getElementById('cashVal').innerText = `$${wallet.cash.toFixed(0)}`;
            
            // Calculate Equity
            let holdingsVal = 0;
            const positionsBox = document.getElementById('positionsPanel');
            positionsBox.innerHTML = "";

            Object.keys(wallet.positions).forEach(sym => {
                const pos = wallet.positions[sym];
                // Find current price
                const coin = marketData.find(c => c.symbol === sym);
                const currPrice = coin ? coin.current_price : pos.entry;
                const val = pos.amount * currPrice;
                holdingsVal += val;

                const pnl = ((currPrice - pos.entry) / pos.entry) * 100;
                
                // Add to panel
                const div = document.createElement('div');
                div.style.padding = "10px";
                div.style.borderBottom = "1px solid #30363d";
                div.style.fontSize = "12px";
                div.innerHTML = `
                    <div style="display:flex; justify-content:space-between">
                        <b>${sym}</b>
                        <span style="color:${pnl>=0?'#2ea043':'#ff7b72'}">${pnl.toFixed(2)}%</span>
                    </div>
                    <div style="color:#8b949e; font-size:11px">$${val.toFixed(2)}</div>
                `;
                positionsBox.appendChild(div);
            });

            const total = wallet.cash + holdingsVal;
            const totalPnl = ((total - 10000) / 10000) * 100;
            
            document.getElementById('equityVal').innerText = `$${total.toFixed(0)}`;
            document.getElementById('pnlVal').innerText = `${totalPnl > 0 ? '+' : ''}${totalPnl.toFixed(2)}%`;
            document.getElementById('pnlVal').className = totalPnl >= 0 ? 'green-txt' : 'red-txt';
        }

        // --- 5. LIVE FEEDS ---
        function startLiveFeed() {
            // Binance WebSocket for Whales + Ticker
            // Using a simple ticker stream to keep prices fresh between polling
            const streams = "btcusdt@trade/ethusdt@trade/solusdt@trade/!miniTicker@arr";
            socket = new WebSocket(`wss://stream.binance.com:9443/ws/${streams}`);
            
            socket.onmessage = (e) => {
                const d = JSON.parse(e.data);
                
                // Whale Logic
                if(d.e === 'trade') {
                    const usd = parseFloat(d.p) * parseFloat(d.q);
                    if(usd > 50000) {
                        const box = document.getElementById('whaleFeed');
                        const div = document.createElement('div');
                        div.className = "log-item";
                        div.innerHTML = `<span class="${d.m?'red-txt':'green-txt'}">${d.s.replace('USDT','')} Whale: $${Math.floor(usd/1000)}k</span>`;
                        box.prepend(div);
                        if(box.childElementCount > 20) box.lastChild.remove();
                    }
                }
            };
        }

        function openChart(sym) {
            document.getElementById('chartModal').style.display = 'flex';
            document.getElementById('chartContainer').innerHTML = `
                <iframe src="https://s.tradingview.com/widgetembed/?frameElementId=tradingview_1&symbol=BINANCE:${sym}USDT&interval=60&hidesidetoolbar=1&symboledit=1&saveimage=0&toolbarbg=f1f3f6&studies=[]&theme=dark&style=1&timezone=Etc%2FUTC" 
                style="width:100%; height:100%; border:none;"></iframe>`;
        }

        // Run
        init();
        setInterval(init, 30000); // Re-scan every 30s
    </script>
</body>
</html>